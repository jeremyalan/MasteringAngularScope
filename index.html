<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mastering Angular $scope</title>
    <meta name="description" content="An overview of using $scope in AngularJS">
    <meta name="author" content="Jeremy Mason">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">
    <link rel="stylesheet" href="css/custom.css"><!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css"><!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script type="text/javascript">
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
      
    </script><!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <section>
            <h2><span>Mastering Angular</span><span class="no-upper">&nbsp;$scope</span></h2>
            <p>by Jeremy Mason</p><br>
            <div class="break">
              <h3>Download the slides</h3>
              <div>https://github.com/jeremyalan/MasteringAngularScope</div>
            </div>
            <div class="break">
              <h3>Contact me</h3>
              <div><span>jeremyalan@gmail.com</span><br><span>Twitter @jeremyalan</span></div>
            </div>
          </section>
          <section>
            <h2>Sponsors</h2><img src="slides/images/sponsors.png" height="60%">
          </section>
          <section>
            <h1>Quick Poll</h1>
          </section>
        </section>
        <section>
          <section>
            <h2>Model-View-Whatever</h2>
            <div class="row">
              <div class="span4">
                <div class="strong underline">Model</div>
                <ul>
                  <li>Services</li>
                  <li>Providers</li>
                  <li>Decorators</li>
                </ul>
              </div>
              <div class="span4">
                <div class="strong underline">View</div>
                <ul>
                  <li>Templates</li>
                  <li>Directives</li>
                  <li>Filters</li>
                </ul>
              </div>
              <div class="span4">
                <div class="strong underline">Whatever?</div>
                <ul>
                  <li>$scope</li>
                </ul>
              </div>
            </div>
          </section>
          <section>
            <h2>Basic Example</h2>
            <div>HTML
              <div class="small-75">
                <pre>&lt;body <span class="highlight">ng-controller="MainCtrl"</span>&gt;
  &lt;header&gt;To-Do List&lt;/header&gt;
  &lt;ul&gt;
    &lt;li <span class="highlight">ng-repeat="item in items"</span>&gt;
      &lt;input type="checkbox"
             <span class="highlight">ng-model="isChecked"</span>
             <span class="highlight">ng-change="markAsComplete(item, isChecked)"</span> /&gt;
      &lt;span&gt;<span class="highlight">{{ item.Title }}</span>&lt;/span&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
  &lt;button type="button" <span class="highlight">ng-click="addItem()"</span>&gt;Add Item&lt;/button&gt;
&lt;/body&gt;

</pre>
              </div>
            </div>
            <div>Javascript
              <div class="small-75">
                <pre>function MainCtrl($scope, $http) {
    $http.get('/api/items')
        .success(function (items) {
            $scope.items = items;
        });
        
    $scope.addItem = function() { ... }
    $scope.markAsComplete = function(item, isChecked) { ... }
}</pre>
              </div>
            </div>
          </section>
        </section>
        <section>
          <section>
            <h2><span>What is&nbsp;</span><span class="no-upper">$scope</span></h2>
            <ul>
              <li>Created auto-magically by the framework</li>
              <li><span>Inherits from&nbsp;</span><span class="pre">$rootScope</span><span>&nbsp;</span><span class="small-75">(more later...)</span></li>
              <li>
                <div>Plain Old Javascript Object (POJO)</div>
                <ul>
                  <li><span class="small-75">No special get/set methods</span></li>
                </ul>
              </li>
              <li>
                <div>Used to communicate between components</div>
                <ul>
                  <li><span class="small-75">Usually sharing data, not always</span></li>
                </ul>
              </li>
            </ul>
          </section>
          <section>
            <h2><span>Characteristics of&nbsp;</span><span class="no-upper">$scope</span></h2>
            <ul>
              <li><span class="pre">$watch</span><span>,&nbsp;</span><span class="pre">$digest</span><span>, and &nbsp;</span><span class="pre">$apply</span></li>
              <li><span class="pre">$new(), $parent</span><span class="small-75">&nbsp;(scope inheritance)</span></li>
              <li><span class="pre">$emit()</span><span>,&nbsp;</span><span class="pre">$broadcast()</span><span>, and &nbsp;</span><span class="pre">$on()</span></li>
            </ul>
          </section>
          <section>
            <h2><span class="no-upper">$watch</span></h2>
            <ul>
              <li>No get|set methods = no "change" events
                <pre class="strike">$scope.on('change:isChecked', function () { ... });</pre>
              </li>
              <li>
                <div>Instead of subscriptions, add "watchers"</div>
                <pre>$scope.$watch('isChecked', function () { ... });</pre>
              </li>
              <li><span class="underline">ALL</span><span>&nbsp;watchers are re-evaluated during&nbsp;</span><span class="pre">$digest()</span></li>
            </ul>
          </section>
          <section>
            <h2><span class="no-upper">$watch</span><span>&nbsp;expressions</span></h2>
            <ul>
              <li><span>Can be interpolated via&nbsp;</span><span class="pre">{{ expression }}</span></li>
              <li>Can be passed to Directives via attributes</li>
            </ul>
            <div class="small-90">
              <pre>&lt;body ng-controller="MainCtrl"&gt;
  &lt;header&gt;To-Do List&lt;/header&gt;
  &lt;ul&gt;
    &lt;li ng-repeat="item in items"&gt;
      &lt;input type="checkbox"
             <span class="highlight">ng-model="isChecked"</span>
             <span class="highlight">ng-change="markAsComplete(item, isChecked)"</span> /&gt;
      &lt;span&gt;<span class="highlight">{{ item.Title }}</span>&lt;/span&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
  &lt;button type="button" <span class="highlight">ng-click="addItem()"</span>&gt;Add Item&lt;/button&gt;
&lt;/body&gt;</pre>
            </div>
          </section>
          <section>
            <h2><span class="no-upper">$watch</span><span>&nbsp;expressions</span></h2>
            <div>From the docs...</div>
            <pre class="text-center-imp">Angular expressions are JavaScript-like code snippets that
are usually placed in bindings such as {{ expression }}.
</pre>
            <div class="break"></div>
            <ul>
              <li>
                <div><span class="pre">$scope.$eval()</span><span class="small-75">&nbsp;- evaluate expression directly</span></div>
                <pre>$scope.$eval('model.Name')</pre>
              </li>
              <li>
                <div><span class="pre">$parse</span><span class="small-75">&nbsp;- convert expressions into functions</span></div>
                <pre>var getter = $parse(<span class="highlight">'model.Name'</span>);
var setter = getter.assign;

var result = getter($scope);
setter($scope, 'Bob Smith');</pre>
              </li>
            </ul>
          </section>
          <section>
            <h2><span>The&nbsp;</span><span class="no-upper">$digest</span><span>&nbsp;Cycle</span></h2>
            <ol class="no-wrap">
              <li><span>Re-evaluates&nbsp;</span><span class="underline">ALL</span><span>&nbsp;watchers on&nbsp;</span><span class="pre">$scope</span></li>
              <li class="break"><span>Call&nbsp;</span><span class="pre">$watch</span><span>&nbsp;function if value changes</span></li>
              <li class="break">
                <div>Repeat until no more changes</div>
                <ul>
                  <li><span class="small-75">Gives up after 10 consecutive iterations</span></li>
                </ul>
              </li>
            </ol>
          </section>
          <section>
            <h2><span>The&nbsp;</span><span class="no-upper">$digest</span><span>&nbsp;Cycle</span></h2>
            <ul class="no-wrap">
              <li>
                <div><span>It's NOT Magic!</span><span class="small-75">&nbsp;- must be invoked manually</span></div>
              </li>
              <li>
                <div><span>External actions will&nbsp;</span><span class="underline">NOT</span><span>&nbsp;trigger digest</span></div>
                <ul>
                  <li><span class="small-75 pre">$.ajax()</span></li>
                  <li><span class="pre">setTimeout</span><span>,&nbsp;</span><span class="pre">setInterval</span></li>
                  <li><span class="pre">$('#myButton').on('click', myClickHandler)</span></li>
                </ul>
              </li>
              <li>
                <div><span>Avoid calling&nbsp;</span><span class="pre">$scope.$digest()</span><span>&nbsp;directly</span></div>
                <ul>
                  <li><span class="small-75"><span>Use built-in services:&nbsp;</span><span class="pre">$http</span><span>,&nbsp;</span><span class="pre">$timeout</span><span>,&nbsp;</span><span class="pre">$q</span></span></li>
                </ul>
              </li>
            </ul>
          </section>
          <section>
            <h2><span class="no-upper">$apply</span></h2>
            <pre>$scope.$apply(myFunc);    // Using $apply

$scope.$eval(myFunc);     // Using $eval + $digest
$rootScope.$digest();
</pre>
            <div class="break"></div>
            <ul>
              <li>Evaluates an expression, then starts digest</li>
              <li>
                <div><span class="pre">$apply</span><span>&nbsp;always digests on&nbsp;</span><span class="pre">$rootScope</span></div>
                <ul>
                  <li><span class="small-75">Can affect overall performance</span></li>
                </ul>
              </li>
              <li><span>Avoid calling&nbsp;</span><span class="pre">$apply()</span><span>&nbsp;directly</span></li>
            </ul>
          </section>
        </section>
        <section>
          <section>
            <h2>Scope Inheritance</h2>
            <ul>
              <li><span>All scopes are descendants of&nbsp;</span><span class="pre">$rootScope</span></li>
              <li><span class="pre">$scope.$new()</span><span class="small-75">&nbsp;- creates a new child scope</span></li>
              <li>
                <div><span class="pre">$scope.$parent</span><span class="small-75">&nbsp;- refers to parent scope</span></div>
                <ul>
                  <li><span class="small-75"><span>Avoid using&nbsp;</span><span class="pre">$parent</span></span></li>
                </ul>
              </li>
            </ul>
          </section>
          <section>
            <h2>Scope Inheritance</h2>
            <h3>Child Scopes</h3>
            <ul>
              <li><span>All scopes are descendants of&nbsp;</span><span class="pre">$rootScope</span></li>
              <li><span class="pre">$scope.$new()</span><span class="small-75">&nbsp;- creates a new child scope</span></li>
              <li>
                <div><span class="pre">$scope.$parent</span><span class="small-75">&nbsp;- refers to parent scope</span></div>
                <ul>
                  <li><span class="small-75"><span>Avoid using&nbsp;</span><span class="pre">$parent</span></span></li>
                </ul>
              </li>
            </ul>
          </section>
          <section>
            <h2>Constant</h2>
            <div><span>module.constant(...)</span></div>
            <pre>angular.module('api')
    .constant('$apiKey', <span class="highlight">'1234567890abcdef'</span>);</pre>
          </section>
          <section>
            <h2>Service</h2>
            <div><span>module.service(...)</span></div>
            <pre>function PersonService($http) {
    this.create = function (info) {
        return $http.post('/api/person', info);
    };
}

angular.module('api')
    .service('$person', <span class="highlight">PersonService</span>);</pre>
          </section>
          <section>
            <h2>Factory</h2>
            <div><span>module.factory(...)</span></div>
            <pre>angular.module('api')
    .factory('$person', function ($http) {
        <span class="highlight">return {</span>
            create: function (info) {
                return $http.post('/api/person', info);
            }
        <span class="highlight">};</span>
    });</pre>
          </section>
          <section>
            <h2>Provider</h2>
            <div><span>module.provider(...)</span></div>
            <pre>angular.module('api')
    .provider('$person', function () {
        <span class="highlight">return {</span>
            <span class="highlight">$get:</span> function ($http) {
                return {
                    create: function (info) {
                        return $http.post('/api/person', info);
                    }
                };
            <span class="highlight">}</span>
        <span class="highlight">};</span>
    });</pre>
          </section>
          <section>
            <h2>Provider</h2>
            <div class="break"></div>
            <ul>
              <li><span>Strong separation between&nbsp;</span><span class="underline">configuration</span><span>&nbsp;and&nbsp;</span><span class="underline">consumption</span></li>
              <li>
                <div>Creates two injectable instances</div>
                <div>
                  <pre>$myService, $myServiceProvider</pre>
                </div>
              </li>
              <li>
                <div>Providers can be injected into config callbacks</div>
                <div class="small-85">
                  <pre>// Fail!
angular.module('...')
    .config(function ($myService) { ... });
    
// OK!
angular.module('...')
    .config(function ($myServiceProvider) { ... });
    
angular.module('...')
    .run(function ($myService) { ... });
    
angular.module('...')
    .run(function ($myServiceProvider) { ... });</pre>
                </div>
              </li>
            </ul>
          </section>
          <section>
            <h2>Provider</h2>
            <div><span>Example</span></div>
            <div class="small-65">
              <pre>angular.module('api')
    .provider('$person', function () {
        var personCache = { };
        var provider = { cache: false };
        
        provider.$get = function ($q, http) {
            return {
                fetch: function (id) {
                    <span class="highlight">
                    if (provider.cache && personCache[id]) {
                        return $q.when(personCache[id]);
                    }
                    </span>
                    return $http.get('/api/persons/' + id)
                        .then(function (result) {
                            <span class="highlight">
                            if (provider.cache) {
                                personCache[id] = result.data;
                            }
                            </span>
                            return result.data;
                        });
                }
            };
        };
        
        return provider;
    });
    
angular.module('myApp')
    .config(function ($personProvider) {
        $personProvider.cache = true;
    });</pre>
            </div>
          </section>
          <section>
            <h2>Decorator</h2>
            <div><span>module.decorator(...)</span></div>
            <pre>angular.module('api')
    .decorator('$person', function ($delegate) {
        var newInstance = {};
        
        // ...
        
        return newInstance;
    });</pre>
            <ul>
              <li><span>Use&nbsp;</span><span class="pre">$delegate</span><span>&nbsp;to inject the service</span></li>
            </ul>
          </section>
          <section>
            <h2>Decorator</h2>
            <div><span>Modify a service using decorator</span></div>
            <pre>angular.module('api')
    .decorator('$person', function ($q, $delegate) {
        var personCache = {};
        
        var fetch = $delegate.fetch;
        <span class="highlight">$delegate.fetch = function (id) {
            if (personCache[id]) {
                return $q.when(personCache[id]);
            }
            
            return fetch(id);
        };
        </span>
        return $delegate;
    });</pre>
          </section>
          <section>
            <h2>Decorator</h2>
            <div><span>Replace a service using decorator</span></div>
            <pre>angular.module('api')
    .decorator('$person', function ($q, $delegate) {
        var personCache = {};
        <span class="highlight">
        return {
            fetch: function (id) {
                if (personCache[id]) {
                    return $q.when(personCache[id]);
                }
                
                return $delegate.fetch(id);
            }
        };</span>
    });</pre>
          </section>
        </section>
        <section>
          <section>
            <h2>Controllers</h2>
            <div><span>module.controller(...)</span></div>
            <pre>function CreatePersonCtrl($scope, $person) {
    $scope.model = {};
    
    $scope.create = function () {
        var info = {
            FirstName: $scope.model.firstName;
            LastName: $scope.model.lastName;
        };
        
        $person.create(info)
            .then(...);
    };
}

angular.module('app')
    .controller('CreatePersonCtrl', CreatePersonCtrl);</pre>
          </section>
        </section>
        <section>
          <section>
            <h2>
              <div>Thanks again to our sponsors!</div>
            </h2>
            <h2>
              <div>Thank you for listening!</div>
            </h2>
            <h2 class="break">Questions?</h2>
          </section>
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>
    <script type="text/javascript">
      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
          controls: true,
          progress: true,
          history: true,
          center: true,
          
          theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
          transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
          
          width: 960,
          height: 700,
          
          maxScale: 5.0,
          
          rollingLinks: true,
          
          // Optional libraries used to extend on reveal.js
          dependencies: [
              { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
              { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
              // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
              // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
          ]
      });
    </script>
  </body>
</html>